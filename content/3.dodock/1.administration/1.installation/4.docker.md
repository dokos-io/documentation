# Installation avec Docker

Dokos fournira prochainement des images Docker, en attendant vous pouvez créer vos propres images Docker en suivant les instructions ici :

::link-card{icon=material-symbols:description-outline href=/dodock/administration/installation/docker-personnalise}
#title
Créer une image Docker pour Dokos

#description
Tutoriel à destination de la communauté Dokos fondé sur le projet Frappe Docker
::

---

<details>
<summary>Une fois que les images officielles seront disponibles, vous pourrez les utiliser en suivant les instructions ci-dessous (cliquez pour afficher).</summary>

## Installer Docker

Si Docker et Docker Compose ne sont pas installés sur votre serveur, vous pouvez utiliser la commande suivante ou vous reporter à la documentation de Docker.

```bash
curl -fsSL https://get.docker.com | bash

# Vérifier l'installation de Docker
docker --version
docker compose version
docker run hello-world
```

## Télécharger le fichier Compose pour Dokos

Téléchargez le fichier `dokos-docker.yml` pour Dokos depuis le dépôt GitLab de Dokos.

::alert{type=info}
:::icon-link{icon=material-symbols:description-outline href=https://gitlab.com/-/snippets/2506120}
Le fichier est accessible ici : <span>https://</span>gitlab.com/-/snippets/2506120
:::
::

```bash
# curl -o dokos-docker.yml https://gitlab.com/dokos/dokos/raw/v3.x.x/dokos-docker.yml
```

## Lancer Dokos

Vous pouvez ensuite lancer l'installation de Dokos, en utilisant la commande :
```bash
docker compose -p dokos -f dokos-docker.yml up -d
```

L'installation du site peut prendre quelques minutes, vous pouvez suivre son avancement avec la commande `docker logs dokos-create-site-1 -f`, ou simplement attendre avec `docker wait dokos-create-site-1`.


## Accéder à Dokos

Vous pouvez accéder à Dokos en accédant au port 8080 du serveur dans votre navigateur, <http://mon-serveur.fr:8080> par exemplen, ou <http://localhost:8080> pour un serveur local.

Ensuite, vous pouvez vous connecter avec les identifiants suivants :
- Nom d'utilisateur : `Administrator`
- Mot de passe : `admin`

:::alert{type=warning}
N'oubliez pas de changer le mot de passe de l'utilisateur `Administrator` lors de la finalisation de l'installation.
:::

## Arrêter Dokos

Pour arrêter Dokos, vous pouvez utiliser la commande suivante :
```bash
docker compose -p dokos -f dokos-docker.yml down
```

## Sauvegarder et restaurer Dokos

### Sauvegarder Dokos

Pour sauvegarder Dokos **une fois lancé**, vous pouvez utiliser la commande suivante :
```bash
# Le système doit être up pour effectuer une sauvegarde
docker compose -p dokos -f dokos-docker.yml run backend bench backup --with-files --compress
```

### Restaurer Dokos

Pour restaurer Dokos, vous devez d'abord démarrer le système avec le fichier `dokos-docker.yml` et suivre cette procédure :
```bash
# Le projet dokos doit être up pour effectuer une restauration
docker compose -p dokos -f dokos-docker.yml up -d

# Lister les sauvegardes disponibles
docker compose -p dokos -f dokos-docker.yml run backend bench ls sites/frontend/private/backups

# Restaurer la sauvegarde en spécifiant le nom du fichier
docker compose -p dokos -f dokos-docker.yml run backend bench restore \
    [...]-frontend-database.sql.gz \
    --with-public-files [...]-frontend-files.tar.gz \
    --with-private-files [...]-frontend-private-files.tar.gz
```

## Mettre à jour Dokos

Pour mettre à jour Dokos, vous pouvez utiliser la commande suivante :
```bash
docker compose -p dokos -f dokos-docker.yml pull
```

</details>