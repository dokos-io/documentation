---
title: Installation standard
---

# Installation sur Ubuntu 22.04

## Pré-requis

|Logiciel|Usage|
|---|---|
|Python 3.10+||
|Node.js 16||
|Redis 6|Cache et mises à jour en temps réel|
|MariaDB 10.4.x|Base de données|
|yarn 1.12+|Gestion des dépendances Javascript|
|wkhtmltopdf (version 0.12.6 with patched qt)|Génération de PDF|
|cron|Planification des tâches de fond|
|NGINX|Proxy en production|


### Python 3.10

Tout d'abord, vérifiez que Python 3.10+ est installé sur votre machine

```sh
python3 --version
# Python 3.10.6
```

Ensuite, installez pip et venv :

```sh
sudo apt-get update -y
sudo apt-get install -y python3-pip python3-venv
```

### Git, Redis et wkhtmltopdf

Ensuite, installez les paquets suivants :

```sh
# Mise à jour des dépôts
sudo apt-get install -y ca-certificates
sudo apt-get update -y

sudo apt-get install -y git redis-server xvfb libfontconfig wkhtmltopdf
```

::alert{type="info"}
`wkhtmltopdf` est utilisé pour produire des documents PDF depuis Dodock/Dokos.
::

### MariaDB (v10.4 à v10.8)

```sh
sudo apt-get install -y mariadb-server
sudo apt-get install -y mariadb-client  # optionnel
```

Dodock nécessite une configuration particulière de MariaDB.
Éditez le fichier de configuration `/etc/mysql/my.cnf` pour y ajouter les lignes de configuration suivantes :

```yaml
# Dodock Install
[mysqld]
character-set-client-handshake = FALSE
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

[mysql]
default-character-set = utf8mb4
```

Redémarrer le service mysql

```sh
sudo service mysql restart
```

Pendant l'installation, vous devrez choisir un mot de passe pour l'utilisateur *root* pour votre base de données.
Pour le configurer ou le modifier, vous pouvez lancer la commande suivante :
```sh
sudo mysql_secure_installation
# > Enter current password for root (enter for none):
# Appuyer simplement sur Entrée à la première question.

# > Switch to unix_socket authentication [Y/n]
# Répondre non (n) à la question, car nous utiliserons l'authentification par mot de passe.

# > Set root password? [Y/n]
# Répondre oui (Y), puis entrer un mot de passe sécurisé pour l'utilisateur `root` de la base de données.
# Ce mot de passe sera demandé à chaque création de site, ainsi que lors des opérations de maintenance.

# Ensuite, répondre oui (Y) à toutes les questions suivantes.
```

Vérifiez que vous pouvez vous connecter à la base de données

```sh
mysql -u root -p
# Pour quitter la console, tapez `exit`
```

### NodeJS (v16) et yarn

Vous pouvez installer NodeJS via [nvm](https://github.com/nvm-sh/nvm) ou le gestionnaire de paquets de votre distribution.

Par exemple :
```sh
curl -o - https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.3/install.sh | bash
. "$HOME/.nvm/nvm.sh"
nvm install 16
npm install -g yarn
```

Vérifiez que NodeJS a bien été installé
```sh
node -v
# v16.xx.y
```


### Dokos CLI

Dokos CLI est une ligne de commande, adaptée de [Bench](https://github.com/frappe/bench), permettant de gérer vos sites et applications Dodock.  
Vous pouvez l'installer grâce à pip

```sh
export PATH=$PATH:$HOME/.local/bin
python3 -m pip install dokos-cli --quiet
```

Ensuite, vérifiez que Dokos CLI a bien été installée :

```sh
bench --version
# 2.5.3
```

::alert{type="info"}
Si la commande `bench` n'est pas trouvée, relancez votre terminal pour que les modifications de votre variable d'environnement `PATH` soient prises en compte.
En dernier recours, vous pouvez aussi ajouter la ligne `export PATH=$PATH:$HOME/.local/bin` à votre fichier `~/.bashrc`.
::

## Démarrage du serveur et installation

### Création d'un bench

Un bench est un ensemble de sites et d'applications.

```sh
cd  # Retournez dans votre dossier personnel
bench init dokos-bench --version v3.x.x --install-app dokos
cd dokos-bench
```

### Création d'un site

```sh
bench new-site test.local --set-default
# Remplacez `test.local` par le nom de domaine de votre choix
```

### Déploiement du site et démarrage du serveur

```sh
sudo -H bench setup production $USER
```

::alert{type="info"}
Si une erreur se produit lors de l'installation, n'hésitez pas à poster un message sur le [forum](https://community.dokos.io).
::

### Finaliser l'installation

Une fois le site créé, vous pouvez vous connecter et accéder à l'interface d'administration avec l'une des adresses suivantes :
- Si Dokos est installé sur votre ordinateur directement : [http://localhost](http://localhost).
- Si vous avez un enregistrement DNS configuré qui pointe vers votre serveur : [https://test.local](https://test.local).

Utilisez les identifiants suivants :
- Adresse email : `Administrator`
- Mot de passe : le mot de passe que vous avez choisi lors de la création du site.

Suivez les instructions du « Setup Wizard », l'outil d'installation de Dokos, pour finaliser l'installation.

### Pour aller plus loin

Pour le rendre accessible depuis l'extérieur, il faut configurer un enregistrement DNS qui pointe vers votre serveur, et configurer Let's Encrypt pour obtenir un certificat SSL.

::card-grid
  ::link-card
  ---
  icon: mdi:lock-outline
  href: /dodock/administration/certificat
  linkText: "En savoir plus"
  ---
  #title
  Let's Encrypt
  #description
  Configuration du certificat SSL avec Let's Encrypt
  ::
::