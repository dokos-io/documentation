{"_path":"/federation-lieux/federation-de-lieux/annuaire","_dir":"federation-de-lieux","_draft":false,"_partial":false,"_locale":"fr","title":"Annuaire","description":"","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"annuaire-fédération-de-lieux"},"children":[{"type":"text","value":"Annuaire - Fédération de lieux"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Cette application est publiée sous licence GPLv3 à l'adresse suivante:\n"},{"type":"element","tag":"a","props":{"href":"https://gitlab.com/dokos/venues-federation","rel":["nofollow"]},"children":[{"type":"text","value":"https://gitlab.com/dokos/venues-federation"}]}]}]},{"type":"element","tag":"h2","props":{"id":"enregistrements-dentrées-sorties"},"children":[{"type":"text","value":"Enregistrements d'entrées / sorties"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Cette application permet la centralisation des entrées/sorties dans les lieux participant à une fédération.\nElle doit installée avec le modèle applicatif Dodock sur un site dédié.\nIl également est possible d'installer Dokos sur le même site. C'est recommandé si cette instance centralisatrice a vocation a émettre des factures ou à servir d'outil de gestion en parallèle du système de compensation."}]},{"type":"element","tag":"h3","props":{"id":"flux-denregistrement"},"children":[{"type":"text","value":"Flux d'enregistrement"}]},{"type":"element","tag":"mermaid","props":{},"children":[{"type":"text","value":"\nsequenceDiagram\n\t\tparticipant A as QRCode\n    participant B as Instance centrale\n    participant C as Lieu de référence\n    A ->> B: 1.Redirection\n    B ->> C: 2.Authentification\n    B ->> C: 3.Autorisation\n    C ->> B: 4.Enregistrement\n"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"L'authentification utilise le mécanisme OAuth2."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Tous les lieux participant à la fédération doivent avoir un logiciel permettant de servir de fournisseur d'authentification OAuth."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"L'utilisateur va être redirigé vers le site web de son lieu de référence, va s'authentifier sur son lieu, puis être redirigé vers l'instance centrale qui enregistrera son entrée/sortie."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Après la connexion à son lieu d'origine, une requête, optionnelle, permet de vérifier la validité du "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"badge inter-lieux"}]},{"type":"text","value":" de l'utilisateur avant l'enregistrement de son entrée/sortie."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"En cas de retour positif - ou de validation par défaut - la date/heure de passage accompagné des information concernant le lieu dans lequel se trouve l'utilisateur et le lieu fournisseur d'identité sont enregistrées dans l'instance centrale."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Il est possible de mettre en place un "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Webhook"}]},{"type":"text","value":" renvoyant les informations d'enregistrement aux deux lieux concernés par l'enregistrement."}]},{"type":"element","tag":"h3","props":{"id":"configuration-des-lieux-fédérés"},"children":[{"type":"text","value":"Configuration des lieux fédérés"}]},{"type":"element","tag":"h4","props":{"id":"connecteur-oauth2"},"children":[{"type":"text","value":"Connecteur Oauth2"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"L'application de centralisation dispose d'un type de document "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Lieu"}]},{"type":"text","value":" permettant d'enregistrer les lieux participants à la fédération."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"L'ajout d'un nouveau lieu s'accompagne de l'enregistrement de l'URL de base du site servant de fournisseur d'authentification, ainsi que de l'ID et du secret de connexion OAuth permettant de se connecter à ce site."}]},{"type":"element","tag":"h4","props":{"id":"point-daccès-à-lapi-de-confirmation"},"children":[{"type":"text","value":"Point d'accès à l'API de confirmation"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Il est également possible de donner l'adresse d'un point d'accès à une API de confirmation.\nCette API devra renvoyer la clé/valeur suivante:"}]},{"type":"element","tag":"pre","props":{"className":"language-json shiki shiki-themes material-theme-lighter material-theme material-theme-palenight","code":"{\n  \"message\": True/False\n}\n","language":"json","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#89DDFF;--shiki-dark:#89DDFF"},"children":[{"type":"text","value":"{\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#89DDFF;--shiki-dark:#89DDFF"},"children":[{"type":"text","value":"  \""}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#9C3EDA;--shiki-default:#C792EA;--shiki-dark:#C792EA"},"children":[{"type":"text","value":"message"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#89DDFF;--shiki-dark:#89DDFF"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#89DDFF;--shiki-dark:#89DDFF"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#EEFFFF;--shiki-dark:#BABED8"},"children":[{"type":"text","value":" True/False\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#89DDFF;--shiki-dark:#89DDFF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"La valeur renvoyée permet, au delà de la simple authentification, d'autoriser l'utilisateur à avoir accès aux services de fédération.\nSi la valeur est "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"True"}]},{"type":"text","value":", l'utilisateur pourra enregistrer son entrée/sortie.\nSi la valeur est "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"False"}]},{"type":"text","value":", l'utilisateur sera redirigé vers une page lui indiquant que l'accès lui a été refusé."}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Pour les lieux utilisant Dokos, il faut installer l'application suivante: "},{"type":"element","tag":"a","props":{"href":"https://gitlab.com/dokos/federated-venue","rel":["nofollow"]},"children":[{"type":"text","value":"https://gitlab.com/dokos/federated-venue"}]},{"type":"text","value":"\nVous pouvez également mettre en place votre propre point d'accès via les scripts python."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"En l'absence de ce point d'accès, l'accès est autorisé par défaut."}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A ce stade, on considère que si le lieu participe à la fédération et ne souhaite pas implémenter de logique de validation particulière dans son système d'authentification, tous ses utilisateurs sont autorisés à aller dans les autres lieux de la fédération."}]}]},{"type":"element","tag":"h4","props":{"id":"webhooks"},"children":[{"type":"text","value":"Webhooks"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Lors de l'ajout d'un lieu, Dokos va automatiquement créer un "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Webhook"}]},{"type":"text","value":" permettant l'envoi des informations liées à l'enregistrement d'une entrée/sortie aux lieux concernés."}]},{"type":"element","tag":"mermaid","props":{},"children":[{"type":"text","value":"\nsequenceDiagram\n    participant B as Instance centrale\n    participant C as Lieu de référence\n    B ->> C: 1.Authentification\n    B ->> C: 2.Autorisation\n    C ->> B: 3.Enregistrement\n    B ->> C: 4.Webhook\n"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"La configuration par défaut correspond à l'appel vers un site fonctionnant avec "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Dokos"}]},{"type":"text","value":". Il est évidemment possible de modifier la configuration pour appeler n'importe quelle autre API."}]},{"type":"element","tag":"h2","props":{"id":"système-de-compensation"},"children":[{"type":"text","value":"Système de compensation"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Seules deux unités de mesure sont prises en compte pour le moment: Demi-journée / Jour"}]}]},{"type":"element","tag":"h3","props":{"id":"consolidation-des-enregistrements"},"children":[{"type":"text","value":"Consolidation des enregistrements"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Toutes les 3 minutes, l'application collecte tous les enregistrements non consolidés et les regroupe par journée.\nEn fonction de la somme des heures enregistrées, l'application comptabilise:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Une demi-journée si la somme <= 4 heures"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Une journée si la somme > 4 heures"}]}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Les informations sont consolidées dans un document appelé "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Récapitulatif des enregistrements dans un lieu"}]}]}]},{"type":"element","tag":"h3","props":{"id":"rapport-consommation-dans-les-lieux"},"children":[{"type":"text","value":"Rapport: Consommation dans les lieux"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Ce rapport permet de constater les consommations par lieu et par unité de mesure.\nLes consommations sont également séparées en fonction du lieu "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"fournisseur"}]}]},{"type":"element","tag":"h3","props":{"id":"rapport-compensations-entre-lieux"},"children":[{"type":"text","value":"Rapport: Compensations entre lieux"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Ce rapport permet de constater les montant restants à compenser entre deux lieux"}]},{"type":"element","tag":"h3","props":{"id":"compensation-entre-lieux"},"children":[{"type":"text","value":"Compensation entre lieux"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Ce document permet d'enregistrer les demi-journées/journées ayant été compensées entre deux lieux."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sélectionnez un lieu \"payeur\", un lieu \"fournisseur\" et une unité de mesure, puis cliquez sur le bouton "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Obtenir des références"}]},{"type":"text","value":" pour récupérer tous les enregistrements consolidés restant à compenser."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Validez votre document pour que la compensation soit prise en compte."}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"enregistrements-dentrées-sorties","depth":2,"text":"Enregistrements d'entrées / sorties","children":[{"id":"flux-denregistrement","depth":3,"text":"Flux d'enregistrement"},{"id":"configuration-des-lieux-fédérés","depth":3,"text":"Configuration des lieux fédérés"}]},{"id":"système-de-compensation","depth":2,"text":"Système de compensation","children":[{"id":"consolidation-des-enregistrements","depth":3,"text":"Consolidation des enregistrements"},{"id":"rapport-consommation-dans-les-lieux","depth":3,"text":"Rapport: Consommation dans les lieux"},{"id":"rapport-compensations-entre-lieux","depth":3,"text":"Rapport: Compensations entre lieux"},{"id":"compensation-entre-lieux","depth":3,"text":"Compensation entre lieux"}]}]}},"_type":"markdown","_id":"content:5.federation-lieux:1.federation-de-lieux:1.annuaire.md","_source":"content","_file":"5.federation-lieux/1.federation-de-lieux/1.annuaire.md","_extension":"md"}